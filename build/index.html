<html>
<head>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/0.3.16/peer.min.js"></script> -->
	<!-- <script>
		// TypeScript 2.2 requires 'exports' global variable.
		var exports = {};
	</script> -->
	<script type="text/javascript" src="scripts\node.js"></script>
	<script type="text/javascript" src="scripts\node.js"></script>
	<script type="text/javascript">
		let networkNode = new Meshnetwork.Node();

		networkNode.onMessageReceived = function (src, data) {
			let log = document.getElementById("log");
			log.value = log.value + src + " sent " + data + "\n";
			log.scrollTop = log.scrollHeight;
		};

		networkNode.onConnectedToPeer = function(user) {
			let otherAddress = document.getElementById("otherAddress");
			otherAddress.innerText = user;
			console.log("A connection was made to peer", user);
		};
		networkNode.onDisconnectedFromNetwork = function() {
			document.getElementById("localAddress").innerText = "";
			document.getElementById("otherAddress").innerText = "";
			console.log("Disconnected from network.");
		};
		networkNode.onConnectedToNetwork = function(localNodeId) {
			let localAddress = document.getElementById("localAddress");
			localAddress.innerText = localNodeId;
			console.log("Connected to network with id:", localNodeId);
		};

		function onConnectButtonClicked() {
			let address = document.getElementById("peerIdTextInput").value;
			networkNode.connectToPeer(address);
		}
		function onSendButtonClicked() {
			let message = document.getElementById("messageInput").value;
			let sendToAddress = document.getElementById("sendToAddress").value;
			networkNode.sendData(message, sendToAddress);
		}

		function copyLocalAddress() {
			var copyText = document.getElementById("localAddress");
			var textArea = document.createElement("textarea");
			textArea.value = copyText.innerText;
			document.body.appendChild(textArea);
			textArea.select();
			document.execCommand("Copy");
			textArea.remove();
		}
	</script>
</head>
<body>
	<div>
		<p>
			Local peer ID: <b id="localAddress"></b>
			<button onclick="copyLocalAddress()">Copy address</button>
		</p>
		<p>Connected to peer: <b id="otherAddress"></b></p>
		<p>
			Peer ID: <input type="text" id="peerIdTextInput">
			<input type="submit" value="Connect" onclick="onConnectButtonClicked()">
		</p>
		<p>
			Send to peer: <input type="text" id="sendToAddress">
		</p>
		<p>
			Message: <input type="text" id="messageInput">
			<input type="submit" value="Send" onclick="onSendButtonClicked()">
		</p>
		<p><textarea id="log" style="width: 500;height: 300;"></textarea></p>
	</div>
</body>
</html>